# 流式传输功能

流式传输功能允许服务器在下载大文件时同时向客户端发送数据，而不是等待整个文件下载完成后再发送。这种方式可以显著提高大文件的响应速度，减少客户端等待时间，并解决下载大文件时可能出现的超时问题。

## 工作原理

传统的代理方式是先将整个文件下载到服务器，然后再发送给客户端：

```
客户端请求 -> 服务器下载完整文件 -> 服务器发送文件给客户端
```

流式传输则是：

```
客户端请求 -> 服务器开始下载文件 -> 服务器边下载边发送数据给客户端
```

这种方式的优势在于：

1. 客户端可以更快地开始接收数据
2. 减少服务器内存使用（不需要在内存中保存整个文件）
3. 避免下载大文件时的超时问题
4. 提高整体响应速度

## 配置选项

流式传输功能可以在`index_config.json`中配置：

```json
{
  "streaming": {
    "enabled": true
  }
}
```

### 参数说明

- `enabled`: 布尔值，控制是否启用流式传输功能。默认为`true`。

## 缓存与流式传输

当启用流式传输时，系统仍然会尝试缓存符合条件的文件。不同之处在于：

- 对于流式传输的文件，系统会先将数据发送给客户端，然后在后台异步缓存文件
- 对于传统模式，系统会先完成下载和缓存，然后再发送给客户端

这确保了即使在启用缓存的情况下，流式传输仍然能够提供更快的初始响应时间。

## 使用场景

流式传输特别适合以下场景：

1. 代理大型文件（如视频、大图片、软件包等）
2. 网络连接不稳定的环境
3. 需要快速响应的应用
4. 服务器内存资源有限的情况

## 注意事项

- 流式传输虽然提高了响应速度，但可能会增加服务器的CPU使用率
- 对于非常小的文件，流式传输的优势不明显
- 在某些特殊情况下，如果源服务器不支持流式传输或响应头中没有Content-Length，可能会影响功能效果